<?xml version="1.0" encoding="UTF-8"?>
<routes xmlns="http://camel.apache.org/schema/spring" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <route id="mockRoute">
        <from uri="direct:mockRouteURI"/>

        <log message="MOCK: Mocking http route ${header.CamelInterceptedEndpoint} ${header.CamelHttpPath}"  loggingLevel="DEBUG"/>

        <choice>
            <when>
                <simple>${header.CamelInterceptedEndpoint} regex '^.*/api/branches.*' &amp;&amp; ${header.CamelHttpMethod} == 'GET'</simple>
                <setHeader name="CamelHttpResponseCode">
                    <constant>200</constant>
                </setHeader>
                <setBody>
                    <simple>resource:classpath:test-data/json/mambuAPI/getBranchesResponse.json</simple>
                </setBody>
                <log message="MOCK: ${header.CamelHttpMethod} ${header.CamelInterceptedEndpoint} ${header.CamelHttpPath} ${header.CamelHttpResponseCode}"  loggingLevel="DEBUG"/>
            </when>
            <when>
                <simple>${header.CamelInterceptedEndpoint} regex '^.*/api/branches' &amp;&amp; ${header.CamelHttpMethod} == 'POST'</simple>
                <setProperty name="TEST_createBranchRequest">
                    <simple>${body}</simple>
                </setProperty>
                <setBody>
                    <simple>resource:classpath:test-data/json/mambuAPI/createBranchResponse.json</simple>
                </setBody>
                <setHeader name="CamelHttpResponseCode">
                    <constant>200</constant>
                </setHeader>
                <log message="MOCK: ${header.CamelHttpMethod} ${header.CamelInterceptedEndpoint} ${header.CamelHttpPath} ${header.CamelHttpResponseCode}"  loggingLevel="DEBUG"/>
            </when>
            <when>
                <simple>${header.CamelInterceptedEndpoint} regex '^.*/api/branches.*' &amp;&amp; ${header.CamelHttpMethod} == 'PUT'</simple>
                <setProperty name="TEST_updateBranchRequest">
                    <simple>${body}</simple>
                </setProperty>
                <setBody>
                    <simple>resource:classpath:test-data/json/mambuAPI/updateBranchRequest.json</simple>
                </setBody>
                <setHeader name="CamelHttpResponseCode">
                    <constant>200</constant>
                </setHeader>
                <log message="MOCK: ${header.CamelHttpMethod} ${header.CamelInterceptedEndpoint} ${header.CamelHttpPath} ${header.CamelHttpResponseCode}"  loggingLevel="DEBUG"/>
            </when>
            <when>
                <simple>${header.CamelInterceptedEndpoint} regex '^.*/api/clients' &amp;&amp; ${header.CamelHttpMethod} == 'POST'</simple>
                <setProperty name="TEST_createPersonRequest">
                    <simple>${body}</simple>
                </setProperty>
                <log message="Create Person Mock Route REQUEST Body: ${body}"/>
                <setBody>
                    <simple>resource:classpath:test-data/json/mambuAPI/createPersonResponse.json</simple>
                </setBody>
                <log message="Create Person Mock Route RESPONSE Body: ${body}"/>
                <setProperty name="personId">
                    <datasonnet bodyMediaType="application/json" outputMediaType="text/plain" resultType="java.lang.String">
                        ds.select(body, "encodedKey")
                    </datasonnet>
                </setProperty>
                <setHeader name="CamelHttpResponseCode">
                    <constant>200</constant>
                </setHeader>
                <log message="MOCK: ${header.CamelHttpMethod} ${header.CamelInterceptedEndpoint} ${header.CamelHttpPath} ${header.CamelHttpResponseCode}"  loggingLevel="DEBUG"/>
            </when>
            <when>
                <simple>${header.CamelInterceptedEndpoint} regex '^.*/api/clients.*' &amp;&amp; ${header.CamelHttpMethod} == 'GET'</simple>
                <setHeader name="CamelHttpResponseCode">
                    <constant>200</constant>
                </setHeader>
                <setBody>
                    <simple>resource:classpath:test-data/json/mambuAPI/getPersonByIdResponse.json</simple>
                </setBody>
                <log message="Get Persons Response Body: ${body}"/>
                <log message="MOCK: ${header.CamelHttpMethod} ${header.CamelInterceptedEndpoint} ${header.CamelHttpPath} ${header.CamelHttpResponseCode}"  loggingLevel="DEBUG"/>
            </when>
            <!-- <when>
                <simple>${header.CamelInterceptedEndpoint} regex '^.*sql:select count(*) as cnt from person where last_name.*'</simple>
                <setBody>
                    <simple>10</simple>
                </setBody>
                <log message="MOCK: ${header.CamelHttpMethod} ${header.CamelInterceptedEndpoint} ${header.CamelHttpPath} ${header.CamelHttpResponseCode}"  loggingLevel="DEBUG"/>
            </when> -->
            <otherwise>
                <log message="MOCK: No match for ${header.CamelHttpMethod} ${header.CamelInterceptedEndpoint} - CamelHttpPath is ${header.CamelHttpPath}" loggingLevel="DEBUG"/>
            </otherwise>
        </choice>
    </route>
</routes>