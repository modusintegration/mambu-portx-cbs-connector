<?xml version="1.0" encoding="UTF-8"?>
<routes id="mambuRoutes"
        xmlns="http://camel.apache.org/schema/spring"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="
            http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd">
    <route id="findBranchesRoute" routeConfigurationId="*">
        <from uri="direct:findBranches"/>
        <setProperty name="flowId">
            <simple>${routeId}:${id}</simple>
        </setProperty>
        <setBody><constant>{}</constant></setBody>
        <to uri="direct:startRoute"/>
        <log message="== findBranches Route"/>
        <setHeader name="CamelHttpMethod">
            <constant>GET</constant>
        </setHeader>
         <!-- Use processor to set the auth header  -->
        <setProperty name="authHeader">
            <simple>{{mambu.username}}:{{mambu.password}}</simple>
        </setProperty>
        <process ref="encodeAuthHeader" />

        <log message="GET branches request is ${body}"/>
        <to uri="https://{{mambu.host}}/api/branches?throwExceptionOnFailure=false&amp;bridgeEndpoint=true"/>
        <log message="GET branches response is ${body}"/>
        <to uri="direct:endRoute"/>
    </route>
    <route id="testCreateBranchRoute" routeConfigurationId="*">
        <from uri="direct:testCreateBranch"/>
        <setProperty name="flowId">
            <simple>${routeId}:${id}</simple>
        </setProperty>
        <setHeader name="CamelHttpMethod">
            <constant>POST</constant>
        </setHeader>
        <to uri="https://{{mambu.host}}/api/branches"/>
        <choice>
            <when>
                <simple>${header.CamelHttpResponseCode} == 200</simple>
                <setBody><simple>${body}</simple></setBody>
            </when>
            <otherwise>
                <setBody>
                    <constant>null</constant>
                </setBody>
            </otherwise>
        </choice>
    </route>
    <route id="testUpdateBranchRoute" routeConfigurationId="*">
        <from uri="direct:testUpdateBranch"/>
        <setProperty name="flowId">
            <simple>${routeId}:${id}</simple>
        </setProperty>
        <setHeader name="CamelHttpMethod">
            <constant>PUT</constant>
        </setHeader>
        <to uri="https://{{mambu.host}}/api/branches/id"/>
        <choice>
            <when>
                <simple>${header.CamelHttpResponseCode} == 200</simple>
                <setBody><simple>${body}</simple></setBody>
            </when>
            <otherwise>
                <setBody>
                    <constant>null</constant>
                </setBody>
            </otherwise>
        </choice>
    </route>
    <!-- <route id="testDatabaseRoute" routeConfigurationId="*">
        <from uri="direct:testDatabase"/>
        <setProperty name="flowId">
            <simple>${routeId}:${id}</simple>
        </setProperty>
        <to uri="sql:select count(*) as cnt from person where last_name=# and status='A'?dataSource=#myDataSource"/>
        <log message="Result: ${body}:"/> 
    </route> -->
</routes>